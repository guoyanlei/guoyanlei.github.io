<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">

  
  <title>kudu-master节点迁移 | GuoYL&#39;s Notes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="kudu" />
  
  
  
  
  <meta name="description" content="kudu遇到问题：master节点配置较低，需要迁移到性能高的节点上，迁移比较麻烦，特此记录 迁移思路： 1）先添加kudu-master（在新节点上初始化数据目录，从已有master上同步过来元数据，刷新 Raft 配置，启动所有master） 2）删除要迁移的master（停掉所有进程，删除目标master，在新节点上重写 master 的 Raft 配置，再启动所有的）">
<meta property="og:type" content="article">
<meta property="og:title" content="kudu-master节点迁移">
<meta property="og:url" content="http://guoyanlei.top/2018/11/11/2018111101-kudu-master%E8%8A%82%E7%82%B9%E8%BF%81%E7%A7%BB/index.html">
<meta property="og:site_name" content="GuoYL&#39;s Notes">
<meta property="og:description" content="kudu遇到问题：master节点配置较低，需要迁移到性能高的节点上，迁移比较麻烦，特此记录 迁移思路： 1）先添加kudu-master（在新节点上初始化数据目录，从已有master上同步过来元数据，刷新 Raft 配置，启动所有master） 2）删除要迁移的master（停掉所有进程，删除目标master，在新节点上重写 master 的 Raft 配置，再启动所有的）">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2018-11-11T07:30:00.000Z">
<meta property="article:modified_time" content="2019-01-08T03:47:23.266Z">
<meta property="article:author" content="Guo Yanlei">
<meta property="article:tag" content="kudu">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="GuoYL&#39;s Notes" type="application/atom+xml">
  
  <link rel="icon" href="/css/images/favicon.ico">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
    
  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Yanone+Kaffeesatz%3A200%2C300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">
  
<link rel="stylesheet" href="/css/style.css">


  
<script src="/js/jquery-3.1.1.min.js"></script>


  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >
  <link rel="stylesheet" href="/css/hiero.css" >
  <link rel="stylesheet" href="/css/glyphs.css" >

  <!-- Custom CSS -->
  
<link rel="stylesheet" href="/css/my.css">

<meta name="generator" content="Hexo 5.2.0"></head>

<script>
var themeMenus = {};

  themeMenus["/"] = "首页"; 

  themeMenus["/archives"] = "归档"; 

  themeMenus["/categories"] = "分类"; 

  themeMenus["/tags"] = "标签"; 

  themeMenus["/about"] = "关于"; 

</script>


  <body data-spy="scroll" data-target="#toc" data-offset="50">


  <header id="allheader" class="site-header" role="banner">
  <div class="clearfix container">
      <div class="site-branding">

          <h1 class="site-title">
            
              <a href="/" title="GuoYL&#39;s Notes" rel="home"> GuoYL&#39;s Notes </a>
            
          </h1>

          
            <div class="site-description">大志非才不就，大才非学不成</div>
          
            
          <nav id="main-navigation" class="main-navigation" role="navigation">
            <a class="nav-open">Menu</a>
            <a class="nav-close">Close</a>
            <div class="clearfix sf-menu">

              <ul id="main-nav" class="nmenu sf-js-enabled">
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/">首页</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/archives">归档</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/categories">分类</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/tags">标签</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/about">关于</a> </li>
                    
              </ul>
            </div>
          </nav>


      </div>
  </div>
</header>




  <div id="container">
    <div id="wrap">
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-2018111101-kudu-master节点迁移" style="width: 66%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      kudu-master节点迁移
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/2018/11/11/2018111101-kudu-master%E8%8A%82%E7%82%B9%E8%BF%81%E7%A7%BB/" class="article-date">
	  <time datetime="2018-11-11T07:30:00.000Z" itemprop="datePublished">十一月 11, 2018</time>
	</a>

      
	<span id="busuanzi_container_page_pv">
	  本文总阅读量<span id="busuanzi_value_page_pv"></span>次
	</span>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>kudu遇到问题：master节点配置较低，需要迁移到性能高的节点上，迁移比较麻烦，特此记录</p>
<p>迁移思路：</p>
<p>1）先添加kudu-master（在新节点上初始化数据目录，从已有master上同步过来元数据，刷新 Raft 配置，启动所有master）</p>
<p>2）删除要迁移的master（停掉所有进程，删除目标master，在新节点上重写 master 的 Raft 配置，再启动所有的）</p>
<a id="more"></a>

<h3 id="迁移前准备"><a href="#迁移前准备" class="headerlink" title="迁移前准备"></a>迁移前准备</h3><h4 id="1-识别存储目录，kudu的master同tablet一样配置有两个目录"><a href="#1-识别存储目录，kudu的master同tablet一样配置有两个目录" class="headerlink" title="1. 识别存储目录，kudu的master同tablet一样配置有两个目录"></a>1. 识别存储目录，kudu的master同tablet一样配置有两个目录</h4><ul>
<li>fs_wal_dir：write-ahead-logs目录 /data/kudu/master/wal</li>
<li>fs_data_dirs：数据目录 /data/kudu/master/data （线上是/data1/kudu/master/data …）</li>
</ul>
<h4 id="2-识别master的PRC端口，默认端口值为-7051"><a href="#2-识别master的PRC端口，默认端口值为-7051" class="headerlink" title="2. 识别master的PRC端口，默认端口值为 7051"></a>2. 识别master的PRC端口，默认端口值为 7051</h4><h4 id="3-识别master的UUID"><a href="#3-识别master的UUID" class="headerlink" title="3. 识别master的UUID"></a>3. 识别master的UUID</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">打开kudu-master web页面：http:&#x2F;&#x2F;node102.bigdata.dmp.local.com:8051&#x2F;masters</span><br><span class="line"></span><br><span class="line">各master的uuid</span><br><span class="line"></span><br><span class="line">85e0c097fcf747d286f59acf2ae3cfef	LEADER	node102.bigdata.dmp.local.com</span><br><span class="line">c4fc5ceda4454e00ad1257a6489cedcf	FOLLOWER node101.bigdata.dmp.local.com</span><br><span class="line">c7873360d8404fe8bcb3b999b8bd3c2a	FOLLOWER node103.bigdata.dmp.local.com</span><br><span class="line"></span><br><span class="line">rpc_addresses &#123; host: &quot;node102.bigdata.dmp.local.com&quot; port: 7051 &#125;</span><br><span class="line">rpc_addresses &#123; host: &quot;node101.bigdata.dmp.local.com&quot; port: 7051 &#125;</span><br><span class="line">rpc_addresses &#123; host: &quot;node103.bigdata.dmp.local.com&quot; port: 7051 &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="迁移"><a href="#迁移" class="headerlink" title="迁移"></a>迁移</h3><h4 id="1-停掉所有kudu进程"><a href="#1-停掉所有kudu进程" class="headerlink" title="1. 停掉所有kudu进程"></a>1. 停掉所有kudu进程</h4><h4 id="2-在新节点上格式化数据目录"><a href="#2-在新节点上格式化数据目录" class="headerlink" title="2. 在新节点上格式化数据目录"></a>2. 在新节点上格式化数据目录</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p &#x2F;data&#x2F;kudu&#x2F;master&#x2F;</span><br><span class="line">sudo -u kudu kudu fs format --fs_wal_dir&#x3D;&#x2F;data&#x2F;kudu&#x2F;master&#x2F;wal --fs_data_dirs&#x3D;&#x2F;data&#x2F;kudu&#x2F;master&#x2F;data</span><br><span class="line">输出：</span><br><span class="line">I1031 15:38:54.215034  3151 env_posix.cc:1460] Not raising process file limit of 1000000; it is already as high as it can go</span><br><span class="line">I1031 15:38:54.215198  3151 file_cache.cc:463] Constructed file cache lbm with capacity 400000</span><br><span class="line">I1031 15:38:54.218797  3151 fs_manager.cc:377] Generated new instance metadata in path &#x2F;data&#x2F;kudu&#x2F;master&#x2F;data&#x2F;instance:</span><br><span class="line">uuid: &quot;607c73cbf5484411a6be7fb0fc0b1554&quot;</span><br><span class="line">format_stamp: &quot;Formatted at 2018-10-31 07:38:54 on node104.bigdata.dmp.local.com&quot;</span><br><span class="line">I1031 15:38:54.220115  3151 fs_manager.cc:377] Generated new instance metadata in path &#x2F;data&#x2F;kudu&#x2F;master&#x2F;wal&#x2F;instance:</span><br><span class="line">uuid: &quot;607c73cbf5484411a6be7fb0fc0b1554&quot;</span><br><span class="line">format_stamp: &quot;Formatted at 2018-10-31 07:38:54 on node104.bigdata.dmp.local.com&quot;</span><br><span class="line"></span><br><span class="line">sudo -u kudu kudu fs dump uuid --fs_wal_dir&#x3D;&#x2F;data&#x2F;kudu&#x2F;master&#x2F;wal --fs_data_dirs&#x3D;&#x2F;data&#x2F;kudu&#x2F;master&#x2F;data 2&gt;&#x2F;dev&#x2F;null</span><br><span class="line"></span><br><span class="line">输出：</span><br><span class="line">607c73cbf5484411a6be7fb0fc0b1554</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3-在新节点上重写-master-的-Raft-配置"><a href="#3-在新节点上重写-master-的-Raft-配置" class="headerlink" title="3. 在新节点上重写 master 的 Raft 配置"></a>3. 在新节点上重写 master 的 Raft 配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">sudo -u kudu kudu local_replica cmeta rewrite_raft_config --fs_wal_dir&#x3D;&#x2F;data&#x2F;kudu&#x2F;master&#x2F;wal --fs_data_dirs&#x3D;&#x2F;data&#x2F;kudu&#x2F;master&#x2F;data 00000000000000000000000000000000 85e0c097fcf747d286f59acf2ae3cfef:node102.bigdata.dmp.local.com:7051 c4fc5ceda4454e00ad1257a6489cedcf:node101.bigdata.dmp.local.com:7051 c7873360d8404fe8bcb3b999b8bd3c2a:node103.bigdata.dmp.local.com:7051</span><br><span class="line"></span><br><span class="line">直接执行，会报错：</span><br><span class="line">Not found: &#x2F;data&#x2F;kudu&#x2F;master&#x2F;data&#x2F;consensus-meta&#x2F;00000000000000000000000000000000: No such file or directory (error 2)</span><br><span class="line"></span><br><span class="line">从正常到master节点上scp过来：</span><br><span class="line">scp 00000000000000000000000000000000 root@node104.bigdata.dmp.local.com:&#x2F;data&#x2F;kudu&#x2F;master&#x2F;data&#x2F;consensus-meta&#x2F;</span><br><span class="line">chown kudu:kudu 00000000000000000000000000000000</span><br><span class="line"></span><br><span class="line">再次执行输出：</span><br><span class="line">I1031 15:56:30.394467  7935 env_posix.cc:1460] Not raising process file limit of 1000000; it is already as high as it can go</span><br><span class="line">I1031 15:56:30.394745  7935 file_cache.cc:463] Constructed file cache lbm with capacity 400000</span><br><span class="line">I1031 15:56:30.398227  7935 fs_report.cc:345] Block manager report</span><br><span class="line">--------------------</span><br><span class="line">1 data directories: &#x2F;data&#x2F;kudu&#x2F;master&#x2F;data&#x2F;data</span><br><span class="line">Total live blocks: 0</span><br><span class="line">Total live bytes: 0</span><br><span class="line">Total live bytes (after alignment): 0</span><br><span class="line">Total number of LBM containers: 0 (0 full)</span><br><span class="line">Did not check for missing blocks</span><br><span class="line">Did not check for orphaned blocks</span><br><span class="line">Total full LBM containers with extra space: 0 (0 repaired)</span><br><span class="line">Total full LBM container extra space in bytes: 0 (0 repaired)</span><br><span class="line">Total incomplete LBM containers: 0 (0 repaired)</span><br><span class="line">Total LBM partial records: 0 (0 repaired)</span><br><span class="line">I1031 15:56:30.398293  7935 fs_manager.cc:263] Time spent opening block manager: real 0.001s    user 0.000s     sys 0.001s</span><br><span class="line">I1031 15:56:30.398685  7935 fs_manager.cc:266] Opened local filesystem: &#x2F;data&#x2F;kudu&#x2F;master&#x2F;data,&#x2F;data&#x2F;kudu&#x2F;master&#x2F;wal</span><br><span class="line">uuid: &quot;607c73cbf5484411a6be7fb0fc0b1554&quot;</span><br><span class="line">format_stamp: &quot;Formatted at 2018-10-31 07:38:54 on node104.bigdata.dmp.local.com&quot;</span><br><span class="line">I1031 15:56:30.401140  7935 tool_action_local_replica.cc:257] Backed up current config to &#x2F;data&#x2F;kudu&#x2F;master&#x2F;data&#x2F;consensus-meta&#x2F;00000000000000000000000000000000.pre_rewrite.1540972590398731</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="4-启动现有的-master"><a href="#4-启动现有的-master" class="headerlink" title="4. 启动现有的 master"></a>4. 启动现有的 master</h4><h4 id="5-使用以下命令将-master-数据复制到每个新-master，在每台新master上执行，只需要连接到一个master上："><a href="#5-使用以下命令将-master-数据复制到每个新-master，在每台新master上执行，只需要连接到一个master上：" class="headerlink" title="5. 使用以下命令将 master 数据复制到每个新 master，在每台新master上执行，只需要连接到一个master上："></a>5. 使用以下命令将 master 数据复制到每个新 master，在每台新master上执行，只需要连接到一个master上：</h4><p>此步是关键</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">在执行前，确保所有&#x2F;data&#x2F;kudu&#x2F;master&#x2F;目录下内容都是kudu:kudu用户</span><br><span class="line"></span><br><span class="line">chown -R kudu:kudu &#x2F;data&#x2F;kudu&#x2F;master&#x2F;</span><br><span class="line">sudo -u kudu kudu local_replica copy_from_remote --fs_wal_dir&#x3D;&#x2F;data&#x2F;kudu&#x2F;master&#x2F;wal --fs_data_dirs&#x3D;&#x2F;data&#x2F;kudu&#x2F;master&#x2F;data 00000000000000000000000000000000 node102.bigdata.dmp.local.com:7051</span><br><span class="line"></span><br><span class="line">输出：</span><br><span class="line">I1031 16:08:49.705765 11161 env_posix.cc:1460] Not raising process file limit of 1000000; it is already as high as it can go</span><br><span class="line">I1031 16:08:49.706120 11161 file_cache.cc:463] Constructed file cache lbm with capacity 400000</span><br><span class="line">I1031 16:08:49.709882 11161 fs_report.cc:345] Block manager report</span><br><span class="line">--------------------</span><br><span class="line">1 data directories: &#x2F;data&#x2F;kudu&#x2F;master&#x2F;data&#x2F;data</span><br><span class="line">Total live blocks: 0</span><br><span class="line">Total live bytes: 0</span><br><span class="line">Total live bytes (after alignment): 0</span><br><span class="line">Total number of LBM containers: 0 (0 full)</span><br><span class="line">Did not check for missing blocks</span><br><span class="line">Did not check for orphaned blocks</span><br><span class="line">Total full LBM containers with extra space: 0 (0 repaired)</span><br><span class="line">Total full LBM container extra space in bytes: 0 (0 repaired)</span><br><span class="line">Total incomplete LBM containers: 0 (0 repaired)</span><br><span class="line">Total LBM partial records: 0 (0 repaired)</span><br><span class="line">I1031 16:08:49.709954 11161 fs_manager.cc:263] Time spent opening block manager: real 0.002s    user 0.000s     sys 0.001s</span><br><span class="line">I1031 16:08:49.710440 11161 fs_manager.cc:266] Opened local filesystem: &#x2F;data&#x2F;kudu&#x2F;master&#x2F;data,&#x2F;data&#x2F;kudu&#x2F;master&#x2F;wal</span><br><span class="line">uuid: &quot;607c73cbf5484411a6be7fb0fc0b1554&quot;</span><br><span class="line">format_stamp: &quot;Formatted at 2018-10-31 07:38:54 on node104.bigdata.dmp.local.com&quot;</span><br><span class="line">I1031 16:08:49.733937 11161 tablet_copy_client.cc:166] T 00000000000000000000000000000000 P 607c73cbf5484411a6be7fb0fc0b1554: Tablet Copy client: Beginning tablet copy session from remote peer at address node102.bigdata.dmp.local.com:7051</span><br><span class="line">I1031 16:08:49.755112 11161 tablet_copy_client.cc:422] T 00000000000000000000000000000000 P 607c73cbf5484411a6be7fb0fc0b1554: Tablet Copy client: Starting download of 908 data blocks...</span><br><span class="line">I1031 16:08:51.402842 11161 tablet_copy_client.cc:385] T 00000000000000000000000000000000 P 607c73cbf5484411a6be7fb0fc0b1554: Tablet Copy client: Starting download of 1 WAL segments...</span><br><span class="line">I1031 16:08:52.008639 11161 tablet_copy_client.cc:292] T 00000000000000000000000000000000 P 607c73cbf5484411a6be7fb0fc0b1554: Tablet Copy client: Tablet Copy complete. Replacing tablet superblock.</span><br></pre></td></tr></table></figure>

<h4 id="3-在新的和老的上面-重写-master-的-Raft-配置"><a href="#3-在新的和老的上面-重写-master-的-Raft-配置" class="headerlink" title="3. 在新的和老的上面 重写 master 的 Raft 配置"></a>3. 在新的和老的上面 重写 master 的 Raft 配置</h4><p>此步是关键</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo -u kudu kudu local_replica cmeta rewrite_raft_config --fs_wal_dir&#x3D;&#x2F;data&#x2F;kudu&#x2F;master&#x2F;wal --fs_data_dirs&#x3D;&#x2F;data&#x2F;kudu&#x2F;master&#x2F;data 00000000000000000000000000000000 85e0c097fcf747d286f59acf2ae3cfef:node102.bigdata.dmp.local.com:7051 c4fc5ceda4454e00ad1257a6489cedcf:node101.bigdata.dmp.local.com:7051 c7873360d8404fe8bcb3b999b8bd3c2a:node103.bigdata.dmp.local.com:7051 607c73cbf5484411a6be7fb0fc0b1554:node104.bigdata.dmp.local.com:7051</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="6-在cm中添加kudu-master，启动所有master"><a href="#6-在cm中添加kudu-master，启动所有master" class="headerlink" title="6. 在cm中添加kudu-master，启动所有master"></a>6. 在cm中添加kudu-master，启动所有master</h4><p>至此，已经添加新的master，之后就可以删除不想用的master</p>
<h4 id="7-停掉所有进程，在cm中删除kudu-master"><a href="#7-停掉所有进程，在cm中删除kudu-master" class="headerlink" title="7. 停掉所有进程，在cm中删除kudu-master"></a>7. 停掉所有进程，在cm中删除kudu-master</h4><h4 id="8-在新的和老的上面-重写-master-的-Raft-配置（排除已删除的）"><a href="#8-在新的和老的上面-重写-master-的-Raft-配置（排除已删除的）" class="headerlink" title="8. 在新的和老的上面 重写 master 的 Raft 配置（排除已删除的）"></a>8. 在新的和老的上面 重写 master 的 Raft 配置（排除已删除的）</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo -u kudu kudu local_replica cmeta rewrite_raft_config --fs_wal_dir&#x3D;&#x2F;data&#x2F;kudu&#x2F;master&#x2F;wal --fs_data_dirs&#x3D;&#x2F;data&#x2F;kudu&#x2F;master&#x2F;data 00000000000000000000000000000000 85e0c097fcf747d286f59acf2ae3cfef:node102.bigdata.dmp.local.com:7051 c4fc5ceda4454e00ad1257a6489cedcf:node101.bigdata.dmp.local.com:7051 607c73cbf5484411a6be7fb0fc0b1554:node104.bigdata.dmp.local.com:7051</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="9-分别启动master，Tablet-Server"><a href="#9-分别启动master，Tablet-Server" class="headerlink" title="9. 分别启动master，Tablet Server"></a>9. 分别启动master，Tablet Server</h4><h3 id="线上迁移记录"><a href="#线上迁移记录" class="headerlink" title="线上迁移记录"></a>线上迁移记录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">-- 迁移前准备</span><br><span class="line"></span><br><span class="line">36c7f0a6a98a45ce8472fa747d5ac1dd	FOLLOWER	</span><br><span class="line">rpc_addresses &#123; host: &quot;node1.ikh.bigdata.dmp.com&quot; port: 7051 &#125; </span><br><span class="line"></span><br><span class="line">7b0e8b0afc934038ac4afccb05372bb7	LEADER	</span><br><span class="line">rpc_addresses &#123; host: &quot;node3.ikh.bigdata.dmp.com&quot; port: 7051 &#125; </span><br><span class="line"></span><br><span class="line">86961f7799e94afa97c2f2be6773141d	FOLLOWER	</span><br><span class="line">rpc_addresses &#123; host: &quot;node2.ikh.bigdata.dmp.com&quot; port: 7051 &#125; </span><br><span class="line"></span><br><span class="line">-- 迁移</span><br><span class="line"></span><br><span class="line">1. 停掉所有kudu进程</span><br><span class="line">2. 在新节点上格式化数据目录</span><br><span class="line">mkdir -p &#x2F;data&#x2F;kudu&#x2F;master&#x2F;</span><br><span class="line">chown -R kudu:kudu master&#x2F;</span><br><span class="line"></span><br><span class="line">mkdir -p &#x2F;data1&#x2F;kudu&#x2F;master&#x2F;data&#x2F;</span><br><span class="line">mkdir -p &#x2F;data2&#x2F;kudu&#x2F;master&#x2F;data&#x2F;</span><br><span class="line">mkdir -p &#x2F;data3&#x2F;kudu&#x2F;master&#x2F;data&#x2F;</span><br><span class="line">mkdir -p &#x2F;data4&#x2F;kudu&#x2F;master&#x2F;data&#x2F;</span><br><span class="line">mkdir -p &#x2F;data5&#x2F;kudu&#x2F;master&#x2F;data&#x2F;</span><br><span class="line">mkdir -p &#x2F;data6&#x2F;kudu&#x2F;master&#x2F;data&#x2F;</span><br><span class="line">mkdir -p &#x2F;data7&#x2F;kudu&#x2F;master&#x2F;data&#x2F;</span><br><span class="line">mkdir -p &#x2F;data8&#x2F;kudu&#x2F;master&#x2F;data&#x2F;</span><br><span class="line">mkdir -p &#x2F;data9&#x2F;kudu&#x2F;master&#x2F;data&#x2F;</span><br><span class="line">mkdir -p &#x2F;data10&#x2F;kudu&#x2F;master&#x2F;data&#x2F;</span><br><span class="line">mkdir -p &#x2F;data11&#x2F;kudu&#x2F;master&#x2F;data&#x2F;</span><br><span class="line">mkdir -p &#x2F;data12&#x2F;kudu&#x2F;master&#x2F;data&#x2F;</span><br><span class="line"></span><br><span class="line">chown -R kudu:kudu &#x2F;data1&#x2F;kudu&#x2F;master&#x2F;data&#x2F;</span><br><span class="line">chown -R kudu:kudu &#x2F;data2&#x2F;kudu&#x2F;master&#x2F;data&#x2F;</span><br><span class="line">chown -R kudu:kudu &#x2F;data3&#x2F;kudu&#x2F;master&#x2F;data&#x2F;</span><br><span class="line">chown -R kudu:kudu &#x2F;data4&#x2F;kudu&#x2F;master&#x2F;data&#x2F;</span><br><span class="line">chown -R kudu:kudu &#x2F;data5&#x2F;kudu&#x2F;master&#x2F;data&#x2F;</span><br><span class="line">chown -R kudu:kudu &#x2F;data6&#x2F;kudu&#x2F;master&#x2F;data&#x2F;</span><br><span class="line">chown -R kudu:kudu &#x2F;data7&#x2F;kudu&#x2F;master&#x2F;data&#x2F;</span><br><span class="line">chown -R kudu:kudu &#x2F;data8&#x2F;kudu&#x2F;master&#x2F;data&#x2F;</span><br><span class="line">chown -R kudu:kudu &#x2F;data9&#x2F;kudu&#x2F;master&#x2F;data&#x2F;</span><br><span class="line">chown -R kudu:kudu &#x2F;data10&#x2F;kudu&#x2F;master&#x2F;data&#x2F;</span><br><span class="line">chown -R kudu:kudu &#x2F;data11&#x2F;kudu&#x2F;master&#x2F;data&#x2F;</span><br><span class="line">chown -R kudu:kudu &#x2F;data12&#x2F;kudu&#x2F;master&#x2F;data&#x2F;</span><br><span class="line"></span><br><span class="line">sudo -u kudu kudu fs format --fs_wal_dir&#x3D;&#x2F;data&#x2F;kudu&#x2F;master&#x2F;wal --fs_data_dirs&#x3D;&#x2F;data1&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data2&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data3&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data4&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data5&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data6&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data7&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data8&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data9&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data10&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data11&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data12&#x2F;kudu&#x2F;master&#x2F;data&#x2F;</span><br><span class="line"></span><br><span class="line">从输出中获取uuid：</span><br><span class="line">c6a414aeddaa469b9953df0c71fbe245 node51.ikh.bigdata.dmp.com</span><br><span class="line">da6b236ddd48464eb064c2b8e859ce1e node52.ikh.bigdata.dmp.com</span><br><span class="line">86ec16fbeaca455b840c800631ec14c1 node53.ikh.bigdata.dmp.com</span><br><span class="line"></span><br><span class="line">3. 从正常的master节点上把Raft配置scp过来：</span><br><span class="line">scp &#x2F;data1&#x2F;kudu&#x2F;master&#x2F;data&#x2F;consensus-meta&#x2F;00000000000000000000000000000000 root@node51.ikh.bigdata.dmp.com:&#x2F;data1&#x2F;kudu&#x2F;master&#x2F;data&#x2F;consensus-meta&#x2F;</span><br><span class="line">scp &#x2F;data1&#x2F;kudu&#x2F;master&#x2F;data&#x2F;consensus-meta&#x2F;00000000000000000000000000000000 root@node52.ikh.bigdata.dmp.com:&#x2F;data1&#x2F;kudu&#x2F;master&#x2F;data&#x2F;consensus-meta&#x2F;</span><br><span class="line">scp &#x2F;data1&#x2F;kudu&#x2F;master&#x2F;data&#x2F;consensus-meta&#x2F;00000000000000000000000000000000 root@node53.ikh.bigdata.dmp.com:&#x2F;data1&#x2F;kudu&#x2F;master&#x2F;data&#x2F;consensus-meta&#x2F;</span><br><span class="line"></span><br><span class="line">chown kudu:kudu &#x2F;data1&#x2F;kudu&#x2F;master&#x2F;data&#x2F;consensus-meta&#x2F;00000000000000000000000000000000</span><br><span class="line"></span><br><span class="line">4. 把已有的Raft配置写入新的master节点</span><br><span class="line">sudo -u kudu kudu local_replica cmeta rewrite_raft_config --fs_wal_dir&#x3D;&#x2F;data&#x2F;kudu&#x2F;master&#x2F;wal --fs_data_dirs&#x3D;&#x2F;data1&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data2&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data3&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data4&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data5&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data6&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data7&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data8&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data9&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data10&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data11&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data12&#x2F;kudu&#x2F;master&#x2F;data&#x2F; 00000000000000000000000000000000 36c7f0a6a98a45ce8472fa747d5ac1dd:node1.ikh.bigdata.dmp.com:7051 7b0e8b0afc934038ac4afccb05372bb7:node3.ikh.bigdata.dmp.com:7051 86961f7799e94afa97c2f2be6773141d:node2.ikh.bigdata.dmp.com:7051</span><br><span class="line"></span><br><span class="line">5. cm中启动现有的master</span><br><span class="line"></span><br><span class="line">6. 将现有的master中的文件块数据copy到新master上，只需连接其中一个现有master</span><br><span class="line">sudo -u kudu kudu local_replica copy_from_remote --fs_wal_dir&#x3D;&#x2F;data&#x2F;kudu&#x2F;master&#x2F;wal --fs_data_dirs&#x3D;&#x2F;data1&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data2&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data3&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data4&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data5&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data6&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data7&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data8&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data9&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data10&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data11&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data12&#x2F;kudu&#x2F;master&#x2F;data&#x2F; 00000000000000000000000000000000 node1.ikh.bigdata.dmp.com:7051</span><br><span class="line"></span><br><span class="line">7. 停掉master</span><br><span class="line"></span><br><span class="line">8. 在新的和老的所有master上面重写 Raft 配置，其中新master的uuid是第2步中的</span><br><span class="line">sudo -u kudu kudu local_replica cmeta rewrite_raft_config --fs_wal_dir&#x3D;&#x2F;data&#x2F;kudu&#x2F;master&#x2F;wal --fs_data_dirs&#x3D;&#x2F;data1&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data2&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data3&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data4&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data5&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data6&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data7&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data8&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data9&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data10&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data11&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data12&#x2F;kudu&#x2F;master&#x2F;data&#x2F; 00000000000000000000000000000000 36c7f0a6a98a45ce8472fa747d5ac1dd:node1.ikh.bigdata.dmp.com:7051 7b0e8b0afc934038ac4afccb05372bb7:node3.ikh.bigdata.dmp.com:7051 86961f7799e94afa97c2f2be6773141d:node2.ikh.bigdata.dmp.com:7051 c6a414aeddaa469b9953df0c71fbe245:node51.ikh.bigdata.dmp.com:7051 da6b236ddd48464eb064c2b8e859ce1e:node52.ikh.bigdata.dmp.com:7051 86ec16fbeaca455b840c800631ec14c1:node53.ikh.bigdata.dmp.com:7051</span><br><span class="line"></span><br><span class="line">9. 在cm中添加新的kudu-master角色，启动所有master</span><br><span class="line"></span><br><span class="line">10. 停掉所有进程，在cm中删除kudu-master</span><br><span class="line"></span><br><span class="line">11. 在新的和老的上面 重写 master 的 Raft 配置（排除已删除的）</span><br><span class="line">sudo -u kudu kudu local_replica cmeta rewrite_raft_config --fs_wal_dir&#x3D;&#x2F;data&#x2F;kudu&#x2F;master&#x2F;wal --fs_data_dirs&#x3D;&#x2F;data1&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data2&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data3&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data4&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data5&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data6&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data7&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data8&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data9&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data10&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data11&#x2F;kudu&#x2F;master&#x2F;data&#x2F;,&#x2F;data12&#x2F;kudu&#x2F;master&#x2F;data&#x2F; 00000000000000000000000000000000 c6a414aeddaa469b9953df0c71fbe245:node51.ikh.bigdata.dmp.com:7051 da6b236ddd48464eb064c2b8e859ce1e:node52.ikh.bigdata.dmp.com:7051 86ec16fbeaca455b840c800631ec14c1:node53.ikh.bigdata.dmp.com:7051</span><br><span class="line"></span><br><span class="line">12. 启动master，启动tablet server</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--注意：</span><br><span class="line">迁移后之前在impala上建的kudu&quot;外部表&quot;就不能读了，因为它们默认指定的是老的kudu-master地址</span><br><span class="line"></span><br><span class="line">解决办法：</span><br><span class="line"></span><br><span class="line">- 在impala上删掉这些&quot;外部表&quot;（删除过程可能需要等几分钟）</span><br><span class="line">- 之后再重新建表</span><br><span class="line"></span><br><span class="line">drop table prod.ods_kudu_liyue_dsp_issue_log_1d</span><br><span class="line"></span><br><span class="line">create EXTERNAL table prod.ods_kudu_liyue_dsp_issue_log_1d stored as kudu</span><br><span class="line">TBLPROPERTIES(&#39;EXTERNAL&#39;&#x3D;&#39;TRUE&#39;,&#39;kudu.table_name&#39; &#x3D; &#39;ods_kudu_liyue_dsp_issue_log_1d&#39;)</span><br><span class="line">;</span><br></pre></td></tr></table></figure>











      
    </div>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/categories/kudu/">kudu</a>

      
  <span class="ico-tags"></span>
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kudu/" rel="tag">kudu</a></li></ul>

            
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/11/18/2018111801-kafka%E6%B6%88%E6%81%AF%E6%8A%95%E9%80%92%E8%AF%AD%E4%B9%89/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">
        
          kafka消息投递语义
        
      </div>
    </a>
  
  
    <a href="/2018/10/08/2018100801-%E4%BB%8E0%E5%BC%80%E5%A7%8B%E6%9E%B6%E6%9E%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">从0开始架构学习总结</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    
      <ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%81%E7%A7%BB%E5%89%8D%E5%87%86%E5%A4%87"><span class="nav-number">1.</span> <span class="nav-text">迁移前准备</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E8%AF%86%E5%88%AB%E5%AD%98%E5%82%A8%E7%9B%AE%E5%BD%95%EF%BC%8Ckudu%E7%9A%84master%E5%90%8Ctablet%E4%B8%80%E6%A0%B7%E9%85%8D%E7%BD%AE%E6%9C%89%E4%B8%A4%E4%B8%AA%E7%9B%AE%E5%BD%95"><span class="nav-number">1.1.</span> <span class="nav-text">1. 识别存储目录，kudu的master同tablet一样配置有两个目录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E8%AF%86%E5%88%ABmaster%E7%9A%84PRC%E7%AB%AF%E5%8F%A3%EF%BC%8C%E9%BB%98%E8%AE%A4%E7%AB%AF%E5%8F%A3%E5%80%BC%E4%B8%BA-7051"><span class="nav-number">1.2.</span> <span class="nav-text">2. 识别master的PRC端口，默认端口值为 7051</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E8%AF%86%E5%88%ABmaster%E7%9A%84UUID"><span class="nav-number">1.3.</span> <span class="nav-text">3. 识别master的UUID</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%81%E7%A7%BB"><span class="nav-number">2.</span> <span class="nav-text">迁移</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%81%9C%E6%8E%89%E6%89%80%E6%9C%89kudu%E8%BF%9B%E7%A8%8B"><span class="nav-number">2.1.</span> <span class="nav-text">1. 停掉所有kudu进程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%9C%A8%E6%96%B0%E8%8A%82%E7%82%B9%E4%B8%8A%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%95%B0%E6%8D%AE%E7%9B%AE%E5%BD%95"><span class="nav-number">2.2.</span> <span class="nav-text">2. 在新节点上格式化数据目录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E5%9C%A8%E6%96%B0%E8%8A%82%E7%82%B9%E4%B8%8A%E9%87%8D%E5%86%99-master-%E7%9A%84-Raft-%E9%85%8D%E7%BD%AE"><span class="nav-number">2.3.</span> <span class="nav-text">3. 在新节点上重写 master 的 Raft 配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E5%90%AF%E5%8A%A8%E7%8E%B0%E6%9C%89%E7%9A%84-master"><span class="nav-number">2.4.</span> <span class="nav-text">4. 启动现有的 master</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-%E4%BD%BF%E7%94%A8%E4%BB%A5%E4%B8%8B%E5%91%BD%E4%BB%A4%E5%B0%86-master-%E6%95%B0%E6%8D%AE%E5%A4%8D%E5%88%B6%E5%88%B0%E6%AF%8F%E4%B8%AA%E6%96%B0-master%EF%BC%8C%E5%9C%A8%E6%AF%8F%E5%8F%B0%E6%96%B0master%E4%B8%8A%E6%89%A7%E8%A1%8C%EF%BC%8C%E5%8F%AA%E9%9C%80%E8%A6%81%E8%BF%9E%E6%8E%A5%E5%88%B0%E4%B8%80%E4%B8%AAmaster%E4%B8%8A%EF%BC%9A"><span class="nav-number">2.5.</span> <span class="nav-text">5. 使用以下命令将 master 数据复制到每个新 master，在每台新master上执行，只需要连接到一个master上：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E5%9C%A8%E6%96%B0%E7%9A%84%E5%92%8C%E8%80%81%E7%9A%84%E4%B8%8A%E9%9D%A2-%E9%87%8D%E5%86%99-master-%E7%9A%84-Raft-%E9%85%8D%E7%BD%AE"><span class="nav-number">2.6.</span> <span class="nav-text">3. 在新的和老的上面 重写 master 的 Raft 配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-%E5%9C%A8cm%E4%B8%AD%E6%B7%BB%E5%8A%A0kudu-master%EF%BC%8C%E5%90%AF%E5%8A%A8%E6%89%80%E6%9C%89master"><span class="nav-number">2.7.</span> <span class="nav-text">6. 在cm中添加kudu-master，启动所有master</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-%E5%81%9C%E6%8E%89%E6%89%80%E6%9C%89%E8%BF%9B%E7%A8%8B%EF%BC%8C%E5%9C%A8cm%E4%B8%AD%E5%88%A0%E9%99%A4kudu-master"><span class="nav-number">2.8.</span> <span class="nav-text">7. 停掉所有进程，在cm中删除kudu-master</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-%E5%9C%A8%E6%96%B0%E7%9A%84%E5%92%8C%E8%80%81%E7%9A%84%E4%B8%8A%E9%9D%A2-%E9%87%8D%E5%86%99-master-%E7%9A%84-Raft-%E9%85%8D%E7%BD%AE%EF%BC%88%E6%8E%92%E9%99%A4%E5%B7%B2%E5%88%A0%E9%99%A4%E7%9A%84%EF%BC%89"><span class="nav-number">2.9.</span> <span class="nav-text">8. 在新的和老的上面 重写 master 的 Raft 配置（排除已删除的）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-%E5%88%86%E5%88%AB%E5%90%AF%E5%8A%A8master%EF%BC%8CTablet-Server"><span class="nav-number">2.10.</span> <span class="nav-text">9. 分别启动master，Tablet Server</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BA%BF%E4%B8%8A%E8%BF%81%E7%A7%BB%E8%AE%B0%E5%BD%95"><span class="nav-number">3.</span> <span class="nav-text">线上迁移记录</span></a></li></ol>
    
    </div>
  </aside>
</section>
        
      </div>
      <footer id="footer" class="site-footer">
  

  <div class="clearfix container">
      <div class="site-info">
	      &copy; 2020 GuoYL&#39;s Notes All Rights Reserved.
          
            <span id="busuanzi_container_site_uv">
              本站访客数<span id="busuanzi_value_site_uv"></span>人次
              本站总访问量<span id="busuanzi_value_site_pv"></span>次
            </span>
          
      </div>
      <div class="site-credit">
        Theme by <a href="https://github.com/iTimeTraveler/hexo-theme-hiero" target="_blank">hiero</a>
      </div>
  </div>
</footer>


<!-- min height -->

<script>
    var contentdiv = document.getElementById("content");

    contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";
</script>

<!-- Custome JS -->

<script src="/js/my.js"></script>

    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/categories" class="mobile-nav-link">Categories</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/scripts.js"></script>


<script src="/js/bootstrap.js"></script>


<script src="/js/main.js"></script>









	<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js" async=""></script>
</body>
</html>
